<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Berkeley Faculty Network - 3D Force Graph</title>
    <link href="https://fonts.googleapis.com/css2?family=Anton&display=swap" rel="stylesheet">
    <style>
        /* CSS Custom Properties for easy opacity control */
        :root {
            --opacity-primary: 0.9;
            --opacity-secondary: 0.3;
            --opacity-tertiary: 0.1;
            --opacity-background: 0.05;
        }
        
        @font-face {
            font-family: 'JetBrains Mono';
            src: url('../fonts/JetBrainsMono-2.304/fonts/webfonts/JetBrainsMono-Regular.woff2') format('woff2');
            
        }
        @font-face {
            font-family: 'JetBrains Mono';
            src: url('../fonts/JetBrainsMono-2.304/fonts/webfonts/JetBrainsMono-Bold.woff2') format('woff2');
            font-weight: 100;
            font-style: normal;
            font-display: swap;
        }
        body {
            font-family: 'JetBrains Mono';
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background: #000;
            color: white;
        }
        
        #wrapper {
            width: 100vw;
            height: 100vh;
            position: relative;
        }
        
        #graph-container {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1;
        }
        
        #ui-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
        }
        
        #search-container {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(10, 10, 10, 0.3);
            backdrop-filter: blur(10px);
            padding: 20px 24px;
            border-radius: 16px;
            pointer-events: auto;
            display: none; /* Hide by default, will be shown after launch */
            gap: 12px;
            align-items: center;
            border: 1.5px solid rgba(130, 202, 255, 0.2);
            font-family: 'JetBrains Mono', monospace;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }
        
        #search-container:hover {
            border-color: rgba(130, 202, 255, var(--opacity-primary));
            box-shadow: 0 12px 40px rgba(0, 0, 0, var(--opacity-primary));
        }
        
        #search-input {
            padding: 12px 16px;
            border: none;
            border-radius: 8px;
            background: rgba(130, 202, 255, 0.1);
            color: white;
            width: 320px;
            font-size: 14px;
            font-family: 'JetBrains Mono', monospace;
            border: 1px solid rgba(130, 202, 255, 0.2);
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
        }
        
        #search-input:focus {
            outline: none;
            border-color: rgba(130, 202, 255, 0.6);
            background: rgba(130, 202, 255, 0.15);
            box-shadow: 0 0 0 3px rgba(130, 202, 255, 0.1);
        }
        
        #search-input::placeholder {
            color: rgba(130, 202, 255, 0.6);
        }
        
        #search-button {
            background: linear-gradient(135deg, #1976d2 0%, #82caff 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-family: 'JetBrains Mono', monospace;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 16px rgba(25, 118, 210, 0.3);
        }
        
        #search-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(25, 118, 210, var(--opacity-primary));
        }
        
        #clear-button {
            background: linear-gradient(135deg, #d32f2f 0%, #f44336 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-family: 'JetBrains Mono', monospace;
            font-weight: bold;
            display: none; /* Hide by default */
            transition: all 0.3s ease;
            box-shadow: 0 4px 16px rgba(211, 47, 47, 0.3);
        }
        
        #clear-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(211, 47, 47, var(--opacity-primary));
        }
        
        #search-results {
            position: absolute;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(10, 10, 10, 0.3);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 16px;
            max-width: 600px;
            max-height: 200px;
            overflow-y: auto;
            display: none;
            border: 1.5px solid rgba(130, 202, 255, 0.2);
            pointer-events: auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            font-family: 'JetBrains Mono', monospace;
        }
        
        #search-results h4 {
            margin-top: 0;
            margin-bottom: 10px;
            color: #82caff;
            font-weight: bold;
        }
        
        #search-results p {
            margin: 5px 0;
            padding: 8px 0;
            border-bottom: 1px solid rgba(130, 202, 255, 0.1);
            color: rgba(255, 255, 255, 0.9);
            transition: all 0.2s ease;
        }
        
        #search-results p:hover {
            background: rgba(130, 202, 255, 0.1);
            border-radius: 4px;
            padding-left: 8px;
        }
        
        #result-cards-container {
            position: fixed;
            top: 50%;
            left: 18px;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 12px;
            z-index: 100;
            pointer-events: none;
            justify-content: center;
            height: auto;
        }
        .result-card {
            background: rgba(10, 10, 10, 0.3);
            backdrop-filter: blur(10px);
            color: #fff;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            padding: 12px 16px;
            min-width: 90px;
            max-width: 110px;
            cursor: pointer;
            transition: all 0.3s ease;
            pointer-events: auto;
            border: 1.5px solid rgba(130, 202, 255, 0.2);
            font-family: 'JetBrains Mono', monospace;
            margin-right: 0;
        }
        .result-card:hover {
            transform: translateX(8px) scale(1.04);
            box-shadow: 0 12px 40px rgba(0, 0, 0, var(--opacity-primary));
            border-color: rgba(130, 202, 255, 0.6);
            background: rgba(130, 202, 255, var(--opacity-tertiary));
        }
        .result-card-title {
            font-size: 0.9em;
            color: #fff;
            margin-bottom: 6px;
            text-align: center;
            font-weight: bold;
        }
        #abstract-modal {
            position: fixed;
            top: 0; left: 0; width: 100vw; height: 100vh;
            background: rgba(0,0,0,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 200;
        }
        #abstract-modal-content {
            background: rgba(10, 10, 10, 0.3);
            backdrop-filter: blur(15px);
            color: #fff;
            border-radius: 16px;
            max-width: 500px;
            padding: 32px 28px 24px 28px;
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.5);
            position: relative;
            font-family: 'JetBrains Mono', monospace;
            border: 1.5px solid rgba(130, 202, 255, 0.2);
        }
        #abstract-modal-content .close-btn {
            position: absolute;
            top: 12px; right: 18px;
            font-size: 1.5em;
            color: #82caff;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s ease;
        }
        #abstract-modal-content .close-btn:hover {
            color: #fff;
            transform: scale(1.1);
        }
        #abstract-modal-content h3 {
            margin-top: 0;
            color: #82caff;
        }
        #abstract-modal-content p {
            margin-bottom: 0;
            color: #fff;
        }
        .loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 18px;
            background: rgba(10, 10, 10, 0.3);
            backdrop-filter: blur(10px);
            padding: 24px 32px;
            border-radius: 16px;
            border: 1.5px solid rgba(130, 202, 255, 0.2);
            pointer-events: auto;
            z-index: 9999;
            color: #fff;
            font-family: 'JetBrains Mono', monospace;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        /* Hide 3d-force-graph control instructions overlay */
        #graph-container > div[style*="rotate"],
        #graph-container > div[style*="controls"],
        #graph-container > div[style*="Click"],
        #graph-container > canvas + div {
          display: none !important;
        }
        
        /* Launch screen animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        
        @keyframes float {
            0%, 100% {
                transform: translateY(0px);
            }
            50% {
                transform: translateY(-20px);
            }
        }
        
        /* Launch button hover effects */
        #launch-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(25,118,210,0.6);
        }
        
        #launch-btn:hover div {
            left: 100%;
        }
        
        /* Stats cards hover effects */
        #author-stats > div > div:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(130,202,255,0.2);
            transition: all 0.3s ease;
        }
        
        /* First level authors hover effects */
        #first-level-authors > div > div:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(130,202,255,0.2);
            border-color: #82caff;
            transition: all 0.3s ease;
        }
        
        /* Mobile Responsive Design */
        @media (max-width: 768px) {
            /* Mobile scrolling support - must come first */
            body {
                overflow: hidden !important; /* Prevent scrolling on mobile */
                height: 100vh !important;
                position: relative !important;
            }
            
            /* Launch screen mobile adjustments */
            #launch-screen {
                position: fixed !important; /* Keep fixed positioning on mobile */
                height: 100vh !important; /* Full viewport height */
                min-height: 100vh !important;
                padding: 10px 0 !important;
                justify-content: flex-start !important;
                overflow-y: auto !important;
                width: 100vw !important;
                top: 0 !important;
                left: 0 !important;
                z-index: 99999 !important; /* Ensure it stays on top */
            }
            
            #launch-screen > div:nth-child(3) {
                padding: 10px !important;
                width: 100% !important;
                max-width: 100% !important;
            }
            
            #launch-screen h1 {
                font-size: 2.2em !important;
                letter-spacing: 2px !important;
                margin-bottom: 4px !important;
            }
            
            #launch-screen p {
                font-size: 1em !important;
                margin-bottom: 24px !important;
            }
            
            #author-stats {
                margin-bottom: 32px !important;
                font-size: 1em !important;
            }
            
            #author-stats > div {
                grid-template-columns: 1fr !important;
                gap: 16px !important;
                max-width: 320px !important;
            }
            
            #author-stats > div > div {
                padding: 16px !important;
            }
            
            #author-stats > div > div > div:last-child {
                font-size: 1.5em !important;
            }
            
            #launch-btn {
                padding: 16px 40px !important;
                font-size: 1.1em !important;
                border-radius: 40px !important;
                margin: 20px 0 !important;
            }
            
            /* First level authors mobile adjustments */
            #first-level-authors {
                margin-bottom: 32px !important;
            }
            
            #first-level-authors > div:first-child {
                font-size: 1em !important;
                margin-bottom: 16px !important;
            }
            
            #first-level-authors > div:last-child {
                grid-template-columns: 1fr !important;
                gap: 12px !important;
                max-width: 320px !important;
            }
            
            #first-level-authors > div:last-child > div {
                padding: 12px !important;
            }
            
            #first-level-authors > div:last-child > div > div:first-child {
                font-size: 0.9em !important;
            }
            
            #first-level-authors > div:last-child > div > div:last-child {
                font-size: 0.7em !important;
            }
            
            /* Search container mobile adjustments */
            #search-container {
                top: 10px !important;
                left: 10px !important;
                right: 10px !important;
                transform: none !important;
                flex-direction: column !important;
                gap: 8px !important;
                padding: 12px !important;
                width: auto !important;
            }
            
            #search-input {
                width: 100% !important;
                max-width: none !important;
                font-size: 16px !important; /* Prevents zoom on iOS */
            }
            
            #search-button, #clear-button {
                padding: 10px 16px !important;
                font-size: 14px !important;
                width: 100% !important;
            }
            
            /* Search results mobile adjustments */
            #search-results {
                top: 120px !important;
                left: 10px !important;
                right: 10px !important;
                transform: none !important;
                max-width: none !important;
                max-height: 150px !important;
            }
            
            /* Result cards mobile adjustments */
            #result-cards-container {
                top: auto !important;
                bottom: 20px !important;
                left: 10px !important;
                right: 10px !important;
                transform: none !important;
                flex-direction: row !important;
                overflow-x: auto !important;
                gap: 8px !important;
                padding: 0 10px !important;
                max-height: 80px !important;
            }
            
            .result-card {
                min-width: 120px !important;
                max-width: 140px !important;
                flex-shrink: 0 !important;
                padding: 8px 10px !important;
            }
            
            .result-card:hover {
                transform: translateY(-4px) scale(1.02) !important;
            }
            
            /* Abstract modal mobile adjustments */
            #abstract-modal {
                padding: 20px !important;
            }
            
            #abstract-modal-content {
                max-width: none !important;
                width: 100% !important;
                padding: 24px 20px 20px 20px !important;
                margin: 0 !important;
                max-height: 80vh !important;
                overflow-y: auto !important;
            }
            
            #abstract-modal-content .close-btn {
                top: 8px !important;
                right: 12px !important;
                font-size: 1.8em !important;
            }
            
            /* Loading screen mobile adjustments */
            .loading {
                font-size: 16px !important;
                padding: 16px !important;
                margin: 0 20px !important;
                text-align: center !important;
            }
            
            /* Background elements mobile adjustments */
            #launch-screen > div:first-child > div {
                width: 100px !important;
                height: 100px !important;
            }
            
            #launch-screen > div:first-child > div:nth-child(2) {
                width: 80px !important;
                height: 80px !important;
            }
            
            #launch-screen > div:first-child > div:nth-child(3) {
                width: 60px !important;
                height: 60px !important;
            }
        }
        
        /* Small mobile devices */
        @media (max-width: 480px) {
            /* Ensure body prevents scrolling */
            body {
                overflow: hidden !important;
                height: 100vh !important;
                position: relative !important;
            }
            
            #launch-screen {
                position: fixed !important;
                height: 100vh !important;
                min-height: 100vh !important;
                padding: 5px 0 !important;
                overflow-y: auto !important;
                z-index: 99999 !important;
            }
            
            #launch-screen > div:nth-child(3) {
                padding: 5px !important;
            }
            
            #launch-screen h1 {
                font-size: 1.8em !important;
                letter-spacing: 1px !important;
                margin-bottom: 8px !important;
            }
            
            #launch-screen p {
                font-size: 0.9em !important;
                margin-bottom: 16px !important;
            }
            
            #author-stats > div {
                max-width: 280px !important;
                gap: 12px !important;
            }
            
            #author-stats > div > div {
                padding: 12px !important;
            }
            
            #author-stats > div > div > div:last-child {
                font-size: 1.3em !important;
            }
            
            #launch-btn {
                padding: 14px 32px !important;
                font-size: 1em !important;
                margin: 16px 0 !important;
            }
            
            /* First level authors small mobile adjustments */
            #first-level-authors {
                margin-bottom: 24px !important;
            }
            
            #first-level-authors > div:last-child {
                max-width: 280px !important;
                gap: 10px !important;
            }
            
            #first-level-authors > div:last-child > div {
                padding: 10px !important;
            }
            
            .result-card {
                min-width: 100px !important;
                max-width: 120px !important;
            }
        }
        
        /* Touch device optimizations */
        @media (hover: none) and (pointer: coarse) {
            /* Disable hover effects on touch devices */
            #launch-btn:hover,
            #author-stats > div > div:hover,
            #first-level-authors > div > div:hover,
            .result-card:hover {
                transform: none !important;
                box-shadow: none !important;
            }
            
            /* Increase touch targets */
            #search-button, #clear-button {
                min-height: 44px !important;
            }
            
            .result-card {
                min-height: 44px !important;
            }
            
            #first-level-authors > div > div {
                min-height: 44px !important;
            }
            
            #abstract-modal-content .close-btn {
                min-width: 44px !important;
                min-height: 44px !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
            }
        }
        
        /* Landscape orientation adjustments */
        @media (max-width: 768px) and (orientation: landscape) {
            /* Ensure body prevents scrolling */
            body {
                overflow: hidden !important;
                height: 100vh !important;
                position: relative !important;
            }
            
            #launch-screen {
                position: fixed !important;
                height: 100vh !important;
                min-height: 100vh !important;
                padding: 10px 0 !important;
                overflow-y: auto !important;
                z-index: 99999 !important;
            }
            
            #launch-screen > div:nth-child(3) {
                padding: 10px !important;
            }
            
            #launch-screen h1 {
                font-size: 1.8em !important;
                margin-bottom: 4px !important;
            }
            
            #launch-screen p {
                margin-bottom: 16px !important;
            }
            
            #author-stats {
                margin-bottom: 20px !important;
            }
            
            #author-stats > div {
                grid-template-columns: repeat(2, 1fr) !important;
                max-width: 500px !important;
                gap: 12px !important;
            }
            
            #author-stats > div > div {
                padding: 12px !important;
            }
            
            #result-cards-container {
                bottom: 10px !important;
                max-height: 60px !important;
            }
            
            /* First level authors landscape adjustments */
            #first-level-authors {
                margin-bottom: 20px !important;
            }
            
            #first-level-authors > div:last-child {
                grid-template-columns: repeat(2, 1fr) !important;
                max-width: 500px !important;
                gap: 10px !important;
            }
            
            #first-level-authors > div:last-child > div {
                padding: 10px !important;
            }
        }
        
        /* Animated background elements with CSS variables */
        .bg-element-1 {
            background: radial-gradient(circle, rgba(130,202,255,var(--opacity-primary)) 0%, transparent 70%);
        }
        .bg-element-2 {
            background: radial-gradient(circle, rgba(25,118,210,var(--opacity-primary)) 0%, transparent 70%);
        }
        .bg-element-3 {
            background: radial-gradient(circle, rgba(100,163,255,var(--opacity-primary)) 0%, transparent 70%);
        }
        
        /* Launch screen background with CSS variables */
        .launch-screen-bg {
            background: linear-gradient(135deg, rgba(10,10,10,var(--opacity-secondary)) 0%, rgba(26,26,46,var(--opacity-primary)) 50%, rgba(22,33,62,var(--opacity-secondary)) 100%);
        }
        
        /* Launch button with CSS variables */
        .launch-btn-shadow {
            box-shadow: 0 8px 32px rgba(25,118,210,var(--opacity-primary));
        }
        
        /* Launch screen base styles */
        #launch-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, rgba(10,10,10,var(--opacity-secondary)) 0%, rgba(26,26,46,var(--opacity-primary)) 50%, rgba(22,33,62,var(--opacity-secondary)) 100%);
            backdrop-filter: blur(2px);
            z-index: 99999;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            overflow-y: auto;
            padding: 20px 0;
        }
        
    </style>
</head>
<body>
    <div id="launch-screen">
        <!-- Animated background elements -->
        <div style="position:absolute;top:0;left:0;width:100%;height:100%;opacity:var(--opacity-background);pointer-events:none;">
            <div class="bg-element-1" style="position:absolute;top:20%;left:10%;width:200px;height:200px;animation:float 6s ease-in-out infinite;"></div>
            <div class="bg-element-2" style="position:absolute;top:60%;right:15%;width:150px;height:150px;animation:float 8s ease-in-out infinite reverse;"></div>
            <div class="bg-element-3" style="position:absolute;bottom:30%;left:20%;width:100px;height:100px;animation:float 7s ease-in-out infinite;"></div>
        </div>
        
        <!-- Main content container -->
        <div style="text-align:center;z-index:2;position:relative;width:100%;max-width:800px;margin:0 auto;padding:20px;">

            
            <!-- Title -->
            <h1 style="font-family:'Anton',sans-serif;font-size:3.2em;color:#fff;margin-bottom:8px;letter-spacing:3px;text-shadow:0 4px 20px rgba(130,202,255,0.3);animation:fadeInUp 1s ease-out 0.2s both;">Research Nebula</h1>
            
            <!-- First Level Authors Section -->
            <div id="first-level-authors" style="font-family:'JetBrains Mono',monospace;color:#fff;text-align:center;margin-bottom:48px;animation:fadeInUp 1s ease-out 0.7s both;">
                <p style="font-size:1em;color:#fff;line-height:1.6;margin-bottom:20px;">
                    Starting with 14 Berkley faculty, the network grows to 604 coauthors in the first degree and 12,275 coauthors in the second degree creating a graph of 12,336 authors and 19,956 connections.
                </p>
                <p style="font-family:'JetBrains Mono',monospace;color:#82caff;font-size:1.1em;margin-bottom:40px;opacity:0.8;animation:fadeInUp 1s ease-out 0.4s both;">The original 14:</p>
                <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px;max-width:800px;margin:0 auto;">
                    <div style="background:rgba(130,202,255,0.1);padding:12px;border-radius:8px;border:1px solid rgba(130,202,255,0.2);backdrop-filter:blur(10px);transition:all 0.3s ease;cursor:pointer;" onclick="window.open('https://scholar.google.com/citations?user=8R35rCwAAAAJ', '_blank')">
                        <div style="font-size:0.9em;color:#fff;font-weight:bold;">Sergey Levine</div>
                    </div>
                    <div style="background:rgba(130,202,255,0.1);padding:12px;border-radius:8px;border:1px solid rgba(130,202,255,0.2);backdrop-filter:blur(10px);transition:all 0.3s ease;cursor:pointer;" onclick="window.open('https://scholar.google.com/citations?user=bh-uRFMAAAAJ', '_blank')">
                        <div style="font-size:0.9em;color:#fff;font-weight:bold;">Trevor Darrell</div>
                    </div>
                    <div style="background:rgba(130,202,255,0.1);padding:12px;border-radius:8px;border:1px solid rgba(130,202,255,0.2);backdrop-filter:blur(10px);transition:all 0.3s ease;cursor:pointer;" onclick="window.open('https://scholar.google.com/citations?user=a4unsk4AAAAJ', '_blank')">
                        <div style="font-size:0.9em;color:#fff;font-weight:bold;">Adam Yala</div>
                    </div>
                    <div style="background:rgba(130,202,255,0.1);padding:12px;border-radius:8px;border:1px solid rgba(130,202,255,0.2);backdrop-filter:blur(10px);transition:all 0.3s ease;cursor:pointer;" onclick="window.open('https://scholar.google.com/citations?user=84WzBlYAAAAJ', '_blank')">
                        <div style="font-size:0.9em;color:#fff;font-weight:bold;">Dawn Song</div>
                    </div>
                    <div style="background:rgba(130,202,255,0.1);padding:12px;border-radius:8px;border:1px solid rgba(130,202,255,0.2);backdrop-filter:blur(10px);transition:all 0.3s ease;cursor:pointer;" onclick="window.open('https://scholar.google.com/citations?user=a_dbdxAAAAAJ', '_blank')">
                        <div style="font-size:0.9em;color:#fff;font-weight:bold;">Benjamin Recht</div>
                    </div>
                    <div style="background:rgba(130,202,255,0.1);padding:12px;border-radius:8px;border:1px solid rgba(130,202,255,0.2);backdrop-filter:blur(10px);transition:all 0.3s ease;cursor:pointer;" onclick="window.open('https://scholar.google.com/citations?user=aO8KpGcAAAAJ', '_blank')">
                        <div style="font-size:0.9em;color:#fff;font-weight:bold;">Jiantao Jiao</div>
                    </div>
                    <div style="background:rgba(130,202,255,0.1);padding:12px;border-radius:8px;border:1px solid rgba(130,202,255,0.2);backdrop-filter:blur(10px);transition:all 0.3s ease;cursor:pointer;" onclick="window.open('https://scholar.google.com/citations?user=LKv32bgAAAAJ', '_blank')">
                        <div style="font-size:0.9em;color:#fff;font-weight:bold;">Jacob Steinhardt</div>
                    </div>
                    <div style="background:rgba(130,202,255,0.1);padding:12px;border-radius:8px;border:1px solid rgba(130,202,255,0.2);backdrop-filter:blur(10px);transition:all 0.3s ease;cursor:pointer;" onclick="window.open('https://scholar.google.com/citations?user=vtwH6GkAAAAJ', '_blank')">
                        <div style="font-size:0.9em;color:#fff;font-weight:bold;">Pieter Abbeel</div>
                    </div>
                    <div style="background:rgba(130,202,255,0.1);padding:12px;border-radius:8px;border:1px solid rgba(130,202,255,0.2);backdrop-filter:blur(10px);transition:all 0.3s ease;cursor:pointer;" onclick="window.open('https://scholar.google.com/citations?user=B96GkdgAAAAJ', '_blank')">
                        <div style="font-size:0.9em;color:#fff;font-weight:bold;">Joseph E. Gonzalez</div>
                    </div>
                    <div style="background:rgba(130,202,255,0.1);padding:12px;border-radius:8px;border:1px solid rgba(130,202,255,0.2);backdrop-filter:blur(10px);transition:all 0.3s ease;cursor:pointer;" onclick="window.open('https://scholar.google.com/citations?user=_pv1sEcAAAAJ', '_blank')">
                        <div style="font-size:0.9em;color:#fff;font-weight:bold;">Ahmed M. Alaa</div>
                    </div>
                    <div style="background:rgba(130,202,255,0.1);padding:12px;border-radius:8px;border:1px solid rgba(130,202,255,0.2);backdrop-filter:blur(10px);transition:all 0.3s ease;cursor:pointer;" onclick="window.open('https://scholar.google.com/citations?user=Wi25oKoAAAAJ', '_blank')">
                        <div style="font-size:0.9em;color:#fff;font-weight:bold;">Xiaoyu (Rayne) Zheng</div>
                    </div>
                    <div style="background:rgba(130,202,255,0.1);padding:12px;border-radius:8px;border:1px solid rgba(130,202,255,0.2);backdrop-filter:blur(10px);transition:all 0.3s ease;cursor:pointer;" onclick="window.open('https://scholar.google.com/citations?user=B847xq8AAAAJ', '_blank')">
                        <div style="font-size:0.9em;color:#fff;font-weight:bold;">Christian Borgs</div>
                    </div>
                    <div style="background:rgba(130,202,255,0.1);padding:12px;border-radius:8px;border:1px solid rgba(130,202,255,0.2);backdrop-filter:blur(10px);transition:all 0.3s ease;cursor:pointer;" onclick="window.open('https://scholar.google.com/citations?user=_tNCgxMAAAAJ', '_blank')">
                        <div style="font-size:0.9em;color:#fff;font-weight:bold;">Anil Aswani</div>
                    </div>
                    <div style="background:rgba(130,202,255,0.1);padding:12px;border-radius:8px;border:1px solid rgba(130,202,255,0.2);backdrop-filter:blur(10px);transition:all 0.3s ease;cursor:pointer;" onclick="window.open('https://scholar.google.com/citations?user=UgHB5oAAAAAJ', '_blank')">
                        <div style="font-size:0.9em;color:#fff;font-weight:bold;">Anca D Dragan</div>
                    </div>
                </div>
            </div>
            
            <!-- Launch Button -->
            <button id="launch-btn" class="launch-btn-shadow" style="background:linear-gradient(135deg, #1976d2 0%, #82caff 100%);color:#fff;border:none;padding:20px 56px;border-radius:50px;cursor:pointer;font-family:'JetBrains Mono',monospace;font-size:1.3em;font-weight:bold;transition:all 0.3s ease;position:relative;overflow:hidden;animation:fadeInUp 1s ease-out 0.8s both;">
                <span style="position:relative;z-index:2;">Launch</span>
                <div style="position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.2),transparent);transition:left 0.5s;"></div>
            </button>
            
            <!-- Footer moved to main content -->
            <div style="margin-top:40px;font-family:'JetBrains Mono',monospace;color:rgba(255,255,255,0.5);font-size:0.9em;animation:fadeIn 1s ease-out 1s both;text-align:center;">
                Created by Nicolas Dickenmann and Daniel Kiss.
            </div>
        </div>
    </div>
    <div id="wrapper">
        <div id="graph-container"></div>
        
        <div id="ui-overlay">
            <div id="search-container">
                <input type="text" id="search-input" placeholder="Search for a concept or topic...">
                <button id="search-button" onclick="performSearch()">Search</button>
                <button id="clear-button" onclick="clearSearch()">Clear</button>
            </div>
            
            <div class="loading" id="loading">Loading network data...</div>
        </div>
    </div>

    <div id="result-cards-container"></div>
    <div id="abstract-modal" style="display:none;">
        <div id="abstract-modal-content"></div>
    </div>

    <script src="https://unpkg.com/3d-force-graph"></script>
    <script>
        // --- COLOR PALETTE ---
        const bluePalette = [
          "#0a1e78", "#142b8a", "#1e389c", "#2845ae", "#3252c0",
          "#3c5fd2", "#467ce4", "#5089f6", "#5a96ff", "#64a3ff",
          "#6eb0ff", "#78bdff", "#82caff", "#8cd7ff", "#96e4ff",
          "#a0f1ff", "#aafcff", "#b4ffff", "#c0ffff", "#d6ffff"
        ];
        const clickedColor = "#1976d2"; // Special blue for clicked node
        const defaultColor = "#fff";

        let Graph;
        let vectorDatabase = [];
        let graphData = null;
        let searchResults = {};
        let lastClickedNodeId = null;
        let lastSearchQuery = '';
        
        // Check if ForceGraph3D is available
        function checkLibrary() {
            if (typeof ForceGraph3D === 'undefined') {
                console.error('ForceGraph3D library not loaded. Trying alternative CDN...');
                // Try alternative CDN
                const script = document.createElement('script');
                script.src = 'https://unpkg.com/3d-force-graph@1.72.5/dist/3d-force-graph.min.js';
                script.onload = () => {
                    console.log('ForceGraph3D loaded from alternative CDN');
                    initializeGraph();
                };
                script.onerror = () => {
                    console.error('Failed to load ForceGraph3D from both CDNs');
                    document.getElementById('loading').innerHTML = 'Error: Could not load 3D Force Graph library. Please check your internet connection.';
                };
                document.head.appendChild(script);
                return false;
            }
            console.log('ForceGraph3D library is available');
            return true;
        }
        
        // Load the data and initialize the graph
        async function initializeGraph() {
            try {
                // Check if library is loaded
                if (!checkLibrary()) {
                    return; // Will be called again when library loads
                }
                
                const response = await fetch('static/forcegraph_data_3.json');
                graphData = await response.json();
                
                // Set all nodes to default color initially
                graphData.nodes.forEach(node => node.color = defaultColor);
                
                document.getElementById('loading').style.display = 'none';
                
                // Initialize the 3D Force Graph
                Graph = ForceGraph3D()(document.getElementById('graph-container'));
                Graph.graphData(graphData);
                Graph.enableNodeDrag(false);
                Graph.onNodeClick(node => {
                    window.open(`https://scholar.google.com/citations?user=${node.id}`, '_blank');
                });
                Graph.onNodeRightClick(node => {
                    node.fx = node.x;
                    node.fy = node.y;
                    node.fz = node.z;
                })
                // Graph.nodeLabel(node =>
                //   `<div style="text-align:center;">
                //     <a href="https://scholar.google.com/citations?user=${node.id}" target="_blank" style="color:#82caff; text-decoration:underline; font-weight:bold;">
                //       ${node.name}
                //     </a>
                //   </div>`
                // );
                Graph.onNodeDragEnd(node => {
                    node.fx = node.x;
                    node.fy = node.y;
                    node.fz = node.z;
                });
                Graph.nodeColor(node => node.color);
                Graph.nodeRelSize(6);
                Graph.linkColor(link => {
                    let targetId = typeof link.target === 'object' ? link.target.id : link.target;
                    let targetNode = graphData.nodes.find(n => n.id === targetId);
                    return targetNode && targetNode.color ? targetNode.color : '#fff';
                });
                
                Graph.linkWidth(1);
                Graph.d3Force('charge').strength(-400).damping(0.9);
                Graph.d3Force('link').distance(100).damping(0.9);
                Graph.onBackgroundClick(() => {
                    // No color reset needed
                });
                
                Graph.linkOpacity(1.0);
                
                Graph.controls().dampingFactor = 0.25;
                
            } catch (error) {
                console.error('Error loading data:', error);
                document.getElementById('loading').innerHTML = 'Error loading data. Please check if forcegraph_data.json exists.';
            }
        }
        
        // --- SEARCH COLORING ---
        function colorNodesBySearchResults(results) {
            // Reset all to white before search
            graphData.nodes.forEach(node => node.color = defaultColor);
            lastClickedNodeId = null;

            // Sort results by similarity descending
            const sorted = [...results].sort((a, b) => b.similarity - a.similarity);
            // Assign blue shades to top 200, 10 per color bucket
            const bucketSize = 10;
            const maxBuckets = bluePalette.length; // 20
            // Keep track of top 200 node ids
            const topNodeIds = new Set();
            sorted.slice(0, bucketSize * maxBuckets).forEach((result, idx) => {
                const node = graphData.nodes.find(n => n.id === result.author_id);
                if (node) {
                    // Reverse: brightest for highest similarity
                    const bucket = Math.floor(idx / bucketSize);
                    const reversedBucket = maxBuckets - 1 - Math.min(bucket, maxBuckets - 1);
                    node.color = bluePalette[reversedBucket];
                    topNodeIds.add(node.id);
                }
            });

            // All other nodes (not in top 200) are #444 after search
            graphData.nodes.forEach(node => {
                if (!topNodeIds.has(node.id)) node.color = '#444';
            });

            Graph.nodeColor(node => node.color);
            Graph.linkColor(link => {
                let targetId = typeof link.target === 'object' ? link.target.id : link.target;
                let targetNode = graphData.nodes.find(n => n.id === targetId);
                return targetNode && targetNode.color ? targetNode.color : '#444';
            });

            showResultCards(results);
        }
        
        // --- SEARCH FUNCTION ---
        async function performSearch() {
            const query = document.getElementById('search-input').value.trim();
            if (!query) return;
            lastSearchQuery = query;
            
            console.log('Performing semantic search for:', query);
            
            try {
                // Call the Flask API for true cosine similarity search
                const response = await fetch('/search', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ query: query })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('API response:', data);
                
                colorNodesBySearchResults(data.results);
                
                // Show the clear button after successful search
                document.getElementById('clear-button').style.display = 'inline-block';
                
            } catch (error) {
                console.error('Error performing search:', error);
                alert('Search failed. Make sure the search API is running.');
            }
        }
        
        // --- CLEAR SEARCH ---
        function clearSearch() {
            document.getElementById('search-input').value = '';
            document.getElementById('result-cards-container').innerHTML = '';
            // Reset all node colors to default
            graphData.nodes.forEach(node => node.color = defaultColor);
            lastClickedNodeId = null;
            Graph.nodeColor(node => node.color);
            Graph.linkColor(link => {
                let targetId = typeof link.target === 'object' ? link.target.id : link.target;
                let targetNode = graphData.nodes.find(n => n.id === targetId);
                return targetNode && targetNode.color ? targetNode.color : defaultColor;
            });
            // Hide the clear button after clearing
            document.getElementById('clear-button').style.display = 'none';
            // Reload the graph to reset camera and view
            //initializeGraph();
        }
        
        // Initialize everything
        if (checkLibrary()) {
            initializeGraph();
        }
        
        // Handle Enter key in search input
        document.getElementById('search-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                performSearch();
            }
        });
        
        // Handle window resize
        window.addEventListener('resize', () => {
            if (Graph) {
                Graph.width(window.innerWidth);
                Graph.height(window.innerHeight);
            }
        });
        
        // Mobile-specific optimizations
        function initializeMobileOptimizations() {
            // Detect mobile device
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth <= 768;
            
            if (isMobile && Graph) {
                // Optimize graph for mobile
                Graph.nodeRelSize(4); // Smaller nodes on mobile
                Graph.d3Force('charge').strength(-300); // Less repulsion
                Graph.d3Force('link').distance(80); // Shorter links
                
                // Disable node dragging on mobile for better performance
                Graph.enableNodeDrag(false);
                
                // Add touch-friendly controls
                Graph.controls().enabled = true;
                Graph.controls().autoRotate = false;
                Graph.controls().autoRotateSpeed = 0;
                
                // Optimize for touch interactions
                Graph.onNodeClick(node => {
                    // Add a small delay to prevent accidental clicks
                    setTimeout(() => {
                        window.open(`https://scholar.google.com/citations?user=${node.id}`, '_blank');
                    }, 100);
                });
                
                // Prevent zoom on double tap
                let lastTouchEnd = 0;
                document.addEventListener('touchend', function (event) {
                    const now = (new Date()).getTime();
                    if (now - lastTouchEnd <= 300) {
                        event.preventDefault();
                    }
                    lastTouchEnd = now;
                }, false);
                
                // Prevent zoom on input focus (iOS)
                const searchInput = document.getElementById('search-input');
                if (searchInput) {
                    searchInput.addEventListener('focus', function() {
                        // Set a small timeout to allow the virtual keyboard to appear
                        setTimeout(() => {
                            window.scrollTo(0, 0);
                        }, 100);
                    });
                }
            }
        }
        
        // Call mobile optimizations after graph initialization
        const originalInitializeGraph = initializeGraph;
        initializeGraph = async function() {
            await originalInitializeGraph();
            initializeMobileOptimizations();
        };

        function showResultCards(results) {
            const container = document.getElementById('result-cards-container');
            container.innerHTML = '';
            if (!results || results.length === 0) return;

            results.slice(0, 7).forEach((result, idx) => {
                const card = document.createElement('div');
                card.className = 'result-card';
                const node = graphData.nodes.find(n => n.id === result.author_id);
                const profName = node ? node.name : result.author_id;
                card.innerHTML = `
                    <div class="result-card-title">${profName}</div>
                `;
                card.onclick = () => showAbstractModal(result);
                container.appendChild(card);
            });
        }

        async function showAbstractModal(result) {
            const modal = document.getElementById('abstract-modal');
            const content = document.getElementById('abstract-modal-content');
            const node = graphData.nodes.find(n => n.id === result.author_id);
            const profName = node ? node.name : result.author_id;
            content.innerHTML = `<span class="close-btn" onclick="closeAbstractModal()">&times;</span>
                <div style="margin-bottom:12px; text-align:left;">
                    <a href="https://scholar.google.com/citations?user=${result.author_id}" target="_blank" style="color:#82caff; text-decoration:underline; font-size:1.1em; font-family:'JetBrains Mono', monospace; font-weight:normal;">${profName}</a>
                </div>
                <div style="margin-bottom:8px; color:#fff; font-size:1em; font-weight:normal; text-align:left;">Loading explanation...</div>
                <div id="zoom-to-node-btn-container" style="margin-top:24px; text-align:left;"></div>`;
            modal.style.display = 'flex';

            console.log("Requesting Gemini explanation for:", result.author_id, lastSearchQuery);
            const response = await fetch('/explain_match', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ query: lastSearchQuery, author_id: result.author_id })
            });
            console.log("Received response from /explain_match");
            const data = await response.json();
            console.log("Gemini explanation:", data.explanation);
            content.innerHTML = `<span class="close-btn" onclick="closeAbstractModal()">&times;</span>
                <div style="margin-bottom:12px; text-align:left;">
                    <a href="https://scholar.google.com/citations?user=${result.author_id}" target="_blank" style="color:#82caff; text-decoration:underline; font-size:1.1em; font-family:'JetBrains Mono', monospace; font-weight:normal;">${profName}</a>
                </div>
                <div style="font-size:1em;line-height:1.5; text-align:left;">${data.explanation}</div>
                <div id="zoom-to-node-btn-container" style="margin-top:24px; text-align:left;"></div>`;

            // Add the zoom button
            const btnContainer = document.getElementById('zoom-to-node-btn-container');
            if (btnContainer) {
                btnContainer.innerHTML = `<button id="zoom-to-node-btn" style="background:linear-gradient(135deg, #1976d2 0%, #82caff 100%);color:#fff;border:none;padding:12px 20px;border-radius:8px;cursor:pointer;font-family:'JetBrains Mono',monospace;font-size:1em;font-weight:bold;transition:all 0.3s ease;box-shadow:0 4px 16px rgba(25,118,210,0.3);">Zoom to Professor on Graph</button>`;
                document.getElementById('zoom-to-node-btn').onclick = function() {
                    zoomToNode(result.author_id);
                    closeAbstractModal();
                };
            }
        }

        // Zoom to node function
        function zoomToNode(nodeId) {
            if (!Graph || !graphData) return;
            const node = graphData.nodes.find(n => n.id === nodeId);
            if (!node) return;
            // Move the camera to focus on the node
            const distance = 300; // how far the camera should be from the node
            const distRatio = 1 + distance / Math.hypot(node.x, node.y, node.z);
            Graph.cameraPosition(
                { x: node.x * distRatio, y: node.y * distRatio, z: node.z * distRatio },
                { x: node.x, y: node.y, z: node.z },
                1000
            );
        }

        function closeAbstractModal() {
            document.getElementById('abstract-modal').style.display = 'none';
        }

        // Hide launch screen on button click
        document.addEventListener('DOMContentLoaded', function() {
            const launchBtn = document.getElementById('launch-btn');
            if (launchBtn) {
                launchBtn.onclick = function() {
                    document.getElementById('launch-screen').style.display = 'none';
                    document.getElementById('search-container').style.display = 'flex'; // Show search container
                };
            }
            
            // Load author statistics for the launch screen
            loadAuthorStats();
        });
        
        // Function to load and display author statistics
        async function loadAuthorStats() {
                // Set fallback values if loading fails
                document.getElementById('first-order-count').textContent = '14';
                document.getElementById('second-order-count').textContent = '604';
                document.getElementById('third-order-count').textContent = '12,275';
                document.getElementById('total-authors').textContent = '12,336';
                document.getElementById('total-number-of-connections').textContent = '19,956';
        }

    </script>
</body>
</html> 